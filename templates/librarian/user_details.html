<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>User Details</title>
    <style>
      body {
        color: #fff;
        background-color: #343a40;
      }
      .page-header {
        background-color: #580000; 
        text-align: center;
        border-radius: 5px;
        margin-bottom: 20px;
        padding: 10px 0;
      }
      .page-header h1 {
        font-weight: 700;
        text-shadow: 2px 2px 4px #000; 
        margin: 0;
      }
      .user-header {
        background-color: #580000; 
        padding: 10px;
        border-radius: 5px;
        margin-bottom: 10px;
      }
      .user-header h2 {
        font-weight: 700; 
        text-shadow: 1px 1px 2px #000; 
        margin: 0;
        cursor: pointer; 
      }
      .user-container {
        background-color: #181b1d; 
        margin-bottom: 20px;
        padding: 15px;
        border-radius: 8px;
      }
      .stats-section {
        background-color: rgb(
          93,
          2,
          2
        ); 
        margin: 10px 0;
        padding: 10px;
        border-radius: 5px;
        transition: transform 0.2s; 
      }
      .stats-section:hover {
        transform: scale(1.02); 
      }
      .list-group-item {
        background-color: #343a40; 
        border: 1px solid #555; 
        transition: background-color 0.2s ease; 
      }
      .list-group-item:hover {
        background-color: #40474e; 
      }
      .container {
        max-width: 960px;
        margin: 0 auto;
        padding: 20px;
      }
      .btn-revoke {
        background-color: #900;
        color: #fff;
        border: none;
        transition: background-color 0.2s ease;
      }
      .btn-revoke:hover {
        background-color: #a00;
      }
      .request-info {
        background-color: #505960;
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 5px;
      }
      .registration-date {
        color: #fff; 
        font-style: italic;
        margin-bottom: 15px;
      }
      .user-details {
        display: none; 
        margin-top: 10px; 
      }
    </style>
  </head>
  <body>
    <script>
      window.addEventListener('DOMContentLoaded', (event) => {
          let errorMessage = '{{ get_flashed_messages(category_filter=["error"])[0] if get_flashed_messages(category_filter=["error"]) }}';
          if (errorMessage && errorMessage.includes('active')) {
              alert(errorMessage);
          }
      });
  </script>
    {% include 'dashboards/navbar.html' %}
    <div class="container">
      <div class="page-header">
        <h1>User Details</h1>
      </div>
      {% for user in users %}
      <div class="user-container">
        <div
          class="user-header"
          onclick="toggleDetails('details-{{ loop.index }}')"
        >
          <h2 style="display: inline">{{ user.username }}</h2>
          <span style="display: inline;">&#9660;</span>
        </div>
        <div id="details-{{ loop.index }}" class="user-details">
          <p>Email: {{ user.email}}</p>
          <p>
            Registered on: {{ user.t_register.strftime('%Y-%m-%d %H:%M:%S') }}</p>
          <p>Role: {{ user.role }}</p>

          {% if not user.is_author %}
          <div class="stats-section">
            <h3>Unapproved Requests</h3>
            {% for request in user.unapproved_requests %}
            <div class="request-info">
              <p>
                Book Title: {{ request.book.name }}, Book ID: {{ request.book_id
                }}, Requested On: {{ request.t_request }}
              </p>
            </div>
            {% else %}
            <p class="no-data">No unapproved requests.</p>
            {% endfor %}
          </div>

          <div class="stats-section">
            <h3>Approved Requests</h3>
            {% for request in user.approved_requests %}
            <div class="request-info">
              <p>
                Book Title: {{ request.book.name }}, Book ID: {{ request.book_id
                }}, Approved, Return by: {{ request.t_deadline }}
              </p>
            </div>
            {% else %}
            <p class="no-data">No approved requests.</p>
            {% endfor %}
          </div>

          <div class="stats-section">
            <h3>Rejected Requests</h3>
            {% for request in user.rejected_requests %}
            <div class="request-info">
              <p>
                Book Title: {{ request.book.name }}, Book ID: {{ request.book_id
                }}, Rejected
              </p>
            </div>
            {% else %}
            <p class="no-data">No rejected requests.</p>
            {% endfor %}
          </div>

          <div class="stats-section">
            <h3>Returned Books</h3>
            {% for request in user.returned_books %}
            <div class="request-info">
              <p>
                Book Title: {{ request.book.name }}, Book ID: {{ request.book_id
                }}, Returned On: {{ request.t_return }}
              </p>
            </div>
            {% else %}
            <p class="no-data">No books returned yet.</p>
            {% endfor %}
          </div>

          <div class="stats-section">
            <h3>Unreturned Books</h3>
            {% for request in user.unreturned_books %}
            <div class="request-info">
              <p>
                Book Title: {{ request.book.name }}, Book ID: {{ request.book_id
                }}, To be returned
              </p>
            </div>
            {% else %}
            <p class="no-data">All books returned.</p>
            {% endfor %}
          </div>
          
          {% else %}
          <div class="stats-section">
            <h3>Authored Books</h3>
            {% if user.authored_books %}
              {% for book in user.authored_books %}
              <div class="request-info">
                <p>Book Title: {{ book.name }}, Book ID: {{ book.id }}</p>
              </div>
              {% endfor %}
            {% else %}
            <p class="no-data">This author has not authored any books.</p>
            {% endif %}
          </div>
          {% endif %}
        </div>
      </div>
      {% endfor %}
    </div>
    <script>
      function toggleDetails(id) {
        var element = document.getElementById(id);
        if (element) {
          element.style.display =
            element.style.display === "block" ? "none" : "block";
        }
      }
    </script>
  </body>
</html>