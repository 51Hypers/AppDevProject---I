<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User Dashboard</title>
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap');
      body {
        font-family: 'Roboto', sans-serif;
        color: #fff;
        background: linear-gradient(
          to right,
          #24243e,
          #302b63,
          #0f0c29
        ); /* Adjust background color */
      }
      .dashboard-container {
        display: flex;
        margin-top: 20px;
      }
      .dashboard-left,
      .dashboard-right {
        flex: 1;
      }
      .stats,
      .deadlines,
      .waiting-approval,
      .finished-books,
      .finished-sections,
      .all-books,
      .all-sections,
      .search-books {
        background-color: #2f2b64; /* Maroon background */
        margin: 10px;
        padding: 20px;
        border-radius: 12px;
      }
      .dashboard-right {
        display: flex;
        flex-wrap: wrap;
      }
      .dashboard-column {
        flex: 50%;
      }
      .btn-custom {
        background-color: #484282;
        color: #fff;
        border: none;
        padding: 0.5rem 1rem;
      }
      .btn-custom:hover {
        background-color: #4c459f;
        color: white;
        box-shadow: 0 12px 56px 0 rgba(0, 0, 0, 0.24),
          0 17px 50px 0 rgba(0, 0, 0, 0.19);
      }
      .form-custom {
        margin-top: 20px;
      }
      input[type='text'] {
        margin-bottom: 10px;
      }

      .stats,
      .all-books {
        box-shadow: rgb(35, 33, 89) -11px 8px 24px;
        margin-bottom: 5rem;
      }

      #filter_type {
        background-color: #484282;
        border: none;
        padding: 0.5rem 1rem;
        color: white;
        border-radius: 0.2rem;
        margin-right: 1rem;
      }

      .filterbtn {
        background-color: #484282;
        color: #fff;
        border: none;
        padding: 0.65rem 1rem;
        border-radius: 0.2rem;
        margin-left: 1rem;
        transition: 0.2s ease-in-out all;
      }

      .filterbtn:hover {
        background-color: #4c459f;
        box-shadow: 0 12px 56px 0 rgba(0, 0, 0, 0.24),
          0 17px 50px 0 rgba(0, 0, 0, 0.19);
      }

      #inputquery {
        padding: 0.5rem 1rem;
        border-radius: 0.2rem;
        border: none;
        outline: #484282;
      }
    </style>
  </head>
  <body>
    {% include 'dashboards/usernav.html' %}
    <div class="container" style="padding-top: 6rem">
      <h2 class="text-center my-4">User Dashboard</h2>
      <div class="dashboard-container">
        <div class="dashboard-left">
          <!-- Placeholder for Stats & Graphs -->
          <div class="stats">
            Stats & Graphs Here
            <h2>Section Distribution</h2>
            <canvas id="sectionPieChart" width="400" height="400"></canvas>
          </div>
          <!-- All Books -->
          <div class="all-books">
            <h4>Available Books</h4>
            <a
              href="{{ url_for('list_all_books') }}"
              class="btn btn-custom btn-sm"
              >View & Request Books</a
            >
            <!-- Search Books -->
            <div class="search-books">
              <h4>Search Books</h4>
              <h1>Filter Books</h1>
              <form action="/books/filter" method="GET">
                <select name="filter_type" id="filter_type">
                  <option value="all">All</option>
                  <option value="section">Section</option>
                  <option value="author">Author</option>
                </select>
                <input
                  type="text"
                  name="query"
                  placeholder="Enter your filter query..."
                  id="inputquery"
                />
                <button type="submit" class="filterbtn">Filter</button>
              </form>
            </div>
            <a
              href="{{ url_for('bought') }}"
              class="btn btn-custom btn-sm"
              >Bought Books</a
            >

            <h2>Revoked Books</h2>
            <ul>
              {% for user_book, book in revbook %}
              <li>{{ book.name }} by {{ book.author }}</li>
              {% endfor %}
            </ul>

            <!-- Deadlines -->
            <div class="deadlines">
              <h4>Borrowed Books and Upcoming Deadlines</h4>
              <ul>
                {% for user_book, book in upcoming_deadlines %}
                <li>
                  <strong>{{ book.name }}</strong> - Deadline: {{
                  user_book.t_deadline }}
                </li>
                {% endfor %}
              </ul>

              <a
                href="{{ url_for('view_borrowed_books_with_deadlines') }}"
                class="btn btn-custom btn-sm"
                >View Borrowed Books</a
              >
            </div>

            <!-- Finished Books -->
            <div class="finished-books">
              <h4>Finished Books</h4>
              <!-- Placeholder for Finished Books List -->
              <a
                href="{{ url_for('view_finished_books') }}"
                class="btn btn-custom btn-sm"
                >View All</a
              >
            </div>
          </div>
          <div class="dashboard-column">
            <!-- Waiting for Approval -->
            <div class="waiting-approval">
              <h4>Waiting for Approval</h4>
              <!-- Placeholder for Books Waiting Approval -->
              <a
                href="{{ url_for('requested_books') }}"
                class="btn btn-custom btn-sm"
                >View Requests</a
              >
            </div>
            <!-- Finished Sections -->
            <div class="finished-sections">
              <h4>Finished Sections</h4>
              <!-- Placeholder for Finished Sections List -->
              <a
                href="{{ url_for('view_finished_books_by_section') }}"
                class="btn btn-custom btn-sm"
                >View All Sections</a
              >
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      fetch('/api/sections_of_interest_chart')
        .then((response) => response.json())
        .then((data) => {
          const canvas = document.getElementById('sectionPieChart');
          const ctx = canvas.getContext('2d');

          const labels = Object.keys(data);
          const values = Object.values(data);

          const backgroundColors = [
            'rgba(255, 99, 132, 0.7)',
            'rgba(54, 162, 235, 0.7)',
            'rgba(255, 206, 86, 0.7)',
            'rgba(75, 192, 192, 0.7)',
            'rgba(153, 102, 255, 0.7)',
            'rgba(255, 159, 64, 0.7)',
          ];

          const hoverBackgroundColors = [
            'rgba(255, 99, 132, 1)',
            'rgba(54, 162, 235, 1)',
            'rgba(255, 206, 86, 1)',
            'rgba(75, 192, 192, 1)',
            'rgba(153, 102, 255, 1)',
            'rgba(255, 159, 64, 1)',
          ];

          new Chart(ctx, {
            type: 'pie',
            data: {
              labels: labels,
              datasets: [
                {
                  data: values,
                  backgroundColor: backgroundColors,
                  hoverBackgroundColor: hoverBackgroundColors,
                },
              ],
            },
            options: {
              responsive: false,
              maintainAspectRatio: false,
              title: {
                display: true,
                text: 'Books Read from Each Section',
              },
            },
          });
        });
    </script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.0.7/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  </body>
</html>
